#  face alignment
import numpy as np
import cv2

MIN_ANGLE = 0.1

class FaceAlignment:
 
    @classmethod
    def rotate_vector(cls,vector, angle, center):

        # correct vector must be reverse in angle respect to face
        angle = -1 * angle
        # Convert angle from degrees to radians
        angle_rad = np.deg2rad(angle)
        
        # Translate the vector to the origin (subtract center coordinates)
        translated_vector = np.subtract(vector, center)
        
        # Perform rotation using rotation matrix
        rotation_matrix = np.array([[np.cos(angle_rad), -np.sin(angle_rad)],
                                    [np.sin(angle_rad), np.cos(angle_rad)]])
        rotated_vector = np.dot(rotation_matrix, translated_vector)
        
        # Translate the rotated vector back to the original position (add center coordinates)
        rotated_vector = np.add(rotated_vector, center)
        int_rotated_vectors = (int(rotated_vector[0]),int(rotated_vector[1]))
        return int_rotated_vectors
    
    @classmethod
    def rotate_image(cls,face_image, angle, center):
        
        if -MIN_ANGLE < angle < MIN_ANGLE:
            return face_image
        # Get image dimensions
        height, width = face_image.shape[:2]
        # Calculate rotation matrix
        rotation_matrix = cv2.getRotationMatrix2D(center, angle, 1.0)
        # Apply rotation to the image
        rotated_image = cv2.warpAffine(face_image, rotation_matrix, (width, height))
        return rotated_image

    @classmethod
    def compute_rotation_angle(cls, eye_coordinates):
    
        x1, x2, y1, y2 = eye_coordinates
        vector1, vector2 = (x1,y1), (x2,y2)
        
        # Calculate the vector between the two points
        vector = np.subtract(vector2, vector1)
        
        # Calculate the angle of the vector relative to the horizontal axis
        angle_rad = np.arctan2(vector[1], vector[0])
        
        # Convert angle from radians to degrees
        angle_deg = np.rad2deg(angle_rad)
        
        return angle_deg, angle_rad
    
    @classmethod
    def xy_eye_mean(cls,landmarks):
        
        x1 = np.array([v[0] for v in landmarks.get('listLeftEye')]).mean()
        x2 = np.array([v[0] for v in landmarks.get('listRightEye')]).mean()
        y1 = np.array([v[1] for v in landmarks.get('listLeftEye')]).mean()
        y2 = np.array([v[1] for v in landmarks.get('listRightEye')]).mean()
        return (x1,x2,y1,y2)
    
    @classmethod
    def center_of_rotation(cls,eye_coordinates):
        
        x1, x2, y1, y2 = eye_coordinates
        x = (x1 + x2) / 2
        y = (y1 + y2) / 2
        return int(x),int(y)
    
    @classmethod
    def rotate_landmarks(cls,angle,center,landmarks):
        if -MIN_ANGLE < angle < MIN_ANGLE:
            return landmarks
        # rotate each vector 
        corrected_landmarks = {}
        for key,vectors in landmarks.items():
            new_vectors = [cls.rotate_vector(points,angle,center) for points in vectors]
            corrected_landmarks[key] = new_vectors
        return corrected_landmarks
    
    @classmethod
    def face_image_landmark_alignment(cls,face_image,landmarks,plot=False):
        if face_image is None or landmarks is None:
            raise ValueError('Image and Face Landmarks must not be None.')
        
        x_y_coordinates = cls.xy_eye_mean(landmarks) 

        if isinstance(face_image,np.ndarray):
            deg,_ = cls.compute_rotation_angle(x_y_coordinates)
            rotation_center = cls.center_of_rotation(x_y_coordinates)
            new_rotated_img = cls.rotate_image(face_image,deg,rotation_center)
            aligned_vectors = cls.rotate_landmarks(deg,rotation_center,landmarks)
            if plot:
                cls.plot_image_point(new_rotated_img,rotation_center,aligned_vectors)
            return new_rotated_img, aligned_vectors

        else:
            from PIL import Image
            # Convert PIL image to NumPy array
            face_image = np.array(face_image)
            deg,_ = cls.compute_rotation_angle(x_y_coordinates)
            rotation_center = cls.center_of_rotation(x_y_coordinates)
            new_rotated_img = cls.rotate_image(face_image,deg,rotation_center)
            aligned_vectors = cls.rotate_landmarks(deg,rotation_center,landmarks)
            if plot:
                cls.plot_image_point(new_rotated_img,rotation_center,aligned_vectors)
            # Convert NumPy array to Pillow image
            pillow_image = Image.fromarray(new_rotated_img)
            return pillow_image, aligned_vectors
            

    @classmethod
    def plot_image_point(cls,face_image,rotation_center,landmarks):
        import matplotlib.pyplot as plt
        from matplotlib import image
        from matplotlib.patches import Rectangle
        
        # for landmark in landmarks:
        for _, point_list in landmarks.items():
            for points in point_list:
                plt.plot(points[0], points[1], marker='o', color='red')
        plt.plot(rotation_center[0], rotation_center[1], marker='o', color='green')
        plt.imshow(face_image)
        plt.show()
        
if __name__ == '__main__':
    
    from PIL import Image
    import matplotlib.pyplot as plt
    
    x = {"listFace": [[395.0, 192.0], [425.0, 194.0], [479.0, 203.0], [514.0, 219.0], [536.0, 245.0], [550.0, 276.0], [554.0, 309.0], [555.0, 349.0], [553.0, 389.0], [548.0, 428.0], [540.0, 469.0], [526.0, 509.0], [508.0, 545.0], [490.0, 571.0], [470.0, 596.0], [451.0, 613.0], [430.0, 626.0], [401.0, 637.0], [378.0, 640.0], [355.0, 636.0], [326.0, 626.0], [305.0, 612.0], [286.0, 595.0], [267.0, 569.0], [250.0, 541.0], [234.0, 503.0], [225.0, 460.0], [220.0, 418.0], [219.0, 379.0], [220.0, 339.0], [223.0, 299.0], [231.0, 267.0], [248.0, 238.0], [272.0, 213.0], [309.0, 199.0], [364.0, 193.0]], "listLeftEye": [[271.0, 338.0], [275.0, 335.0], [279.0, 332.0], [288.0, 328.0], [301.0, 325.0], [315.0, 326.0], [329.0, 332.0], [338.0, 339.0], [342.0, 344.0], [339.0, 346.0], [331.0, 347.0], [319.0, 350.0], [306.0, 351.0], [292.0, 350.0], [283.0, 347.0], [277.0, 343.0]], "listNoseTop": [[390.0, 328.0], [383.0, 459.0]], "listRightEye": [[437.0, 345.0], [441.0, 341.0], [451.0, 333.0], [464.0, 329.0], [478.0, 328.0], [492.0, 331.0], [501.0, 336.0], [505.0, 339.0], [509.0, 342.0], [503.0, 347.0], [496.0, 350.0], [486.0, 353.0], [472.0, 354.0], [459.0, 352.0], [447.0, 349.0], [440.0, 347.0]], "listLeftChick": [[284.0, 454.0]], "listNoseBottom": [[336.0, 467.0], [383.0, 476.0], [430.0, 469.0]], "listRightChick": [[484.0, 458.0]], "listLeftEyeBrowTop": [[245.0, 292.0], [259.0, 277.0], [282.0, 270.0], [313.0, 272.0], [351.0, 277.0]], "listLipLower_Lower": [[441.0, 541.0], [432.0, 547.0], [417.0, 556.0], [400.0, 561.0], [381.0, 563.0], [362.0, 561.0], [345.0, 554.0], [331.0, 545.0], [322.0, 538.0]], "listLipLower_Upper": [[430.0, 534.0], [423.0, 535.0], [412.0, 535.0], [397.0, 536.0], [382.0, 537.0], [366.0, 536.0], [352.0, 534.0], [340.0, 532.0], [333.0, 532.0]], "listLipUpper_Lower": [[324.0, 530.0], [343.0, 530.0], [354.0, 532.0], [367.0, 533.0], [382.0, 535.0], [396.0, 534.0], [410.0, 533.0], [421.0, 532.0], [439.0, 533.0]], "listLipUpper_Upper": [[316.0, 532.0], [321.0, 527.0], [330.0, 523.0], [342.0, 518.0], [362.0, 514.0], [382.0, 518.0], [402.0, 515.0], [422.0, 520.0], [434.0, 526.0], [443.0, 530.0], [448.0, 535.0]], "listRightEyeBrowTop": [[536.0, 298.0], [524.0, 282.0], [501.0, 273.0], [469.0, 275.0], [431.0, 278.0]], "listLeftEyeBrowBottom": [[253.0, 302.0], [267.0, 290.0], [287.0, 285.0], [316.0, 287.0], [355.0, 301.0]], "listRightEyeBrowBottom": [[528.0, 306.0], [515.0, 294.0], [495.0, 288.0], [466.0, 290.0], [425.0, 302.0]]}
    #  np.array(point_list)[point_indices]
    raw_landmarks = {"listFace": [{"X": 395.0, "Y": 192.0}, {"X": 425.0, "Y": 194.0}, {"X": 479.0, "Y": 203.0}, {"X": 514.0, "Y": 219.0}, {"X": 536.0, "Y": 245.0}, {"X": 550.0, "Y": 276.0}, {"X": 554.0, "Y": 309.0}, {"X": 555.0, "Y": 349.0}, {"X": 553.0, "Y": 389.0}, {"X": 548.0, "Y": 428.0}, {"X": 540.0, "Y": 469.0}, {"X": 526.0, "Y": 509.0}, {"X": 508.0, "Y": 545.0}, {"X": 490.0, "Y": 571.0}, {"X": 470.0, "Y": 596.0}, {"X": 451.0, "Y": 613.0}, {"X": 430.0, "Y": 626.0}, {"X": 401.0, "Y": 637.0}, {"X": 378.0, "Y": 640.0}, {"X": 355.0, "Y": 636.0}, {"X": 326.0, "Y": 626.0}, {"X": 305.0, "Y": 612.0}, {"X": 286.0, "Y": 595.0}, {"X": 267.0, "Y": 569.0}, {"X": 250.0, "Y": 541.0}, {"X": 234.0, "Y": 503.0}, {"X": 225.0, "Y": 460.0}, {"X": 220.0, "Y": 418.0}, {"X": 219.0, "Y": 379.0}, {"X": 220.0, "Y": 339.0}, {"X": 223.0, "Y": 299.0}, {"X": 231.0, "Y": 267.0}, {"X": 248.0, "Y": 238.0}, {"X": 272.0, "Y": 213.0}, {"X": 309.0, "Y": 199.0}, {"X": 364.0, "Y": 193.0}], "listLeftEye": [{"X": 271.0, "Y": 338.0}, {"X": 275.0, "Y": 335.0}, {"X": 279.0, "Y": 332.0}, {"X": 288.0, "Y": 328.0}, {"X": 301.0, "Y": 325.0}, {"X": 315.0, "Y": 326.0}, {"X": 329.0, "Y": 332.0}, {"X": 338.0, "Y": 339.0}, {"X": 342.0, "Y": 344.0}, {"X": 339.0, "Y": 346.0}, {"X": 331.0, "Y": 347.0}, {"X": 319.0, "Y": 350.0}, {"X": 306.0, "Y": 351.0}, {"X": 292.0, "Y": 350.0}, {"X": 283.0, "Y": 347.0}, {"X": 277.0, "Y": 343.0}], "listNoseTop": [{"X": 390.0, "Y": 328.0}, {"X": 383.0, "Y": 459.0}], "listRightEye": [{"X": 437.0, "Y": 345.0}, {"X": 441.0, "Y": 341.0}, {"X": 451.0, "Y": 333.0}, {"X": 464.0, "Y": 329.0}, {"X": 478.0, "Y": 328.0}, {"X": 492.0, "Y": 331.0}, {"X": 501.0, "Y": 336.0}, {"X": 505.0, "Y": 339.0}, {"X": 509.0, "Y": 342.0}, {"X": 503.0, "Y": 347.0}, {"X": 496.0, "Y": 350.0}, {"X": 486.0, "Y": 353.0}, {"X": 472.0, "Y": 354.0}, {"X": 459.0, "Y": 352.0}, {"X": 447.0, "Y": 349.0}, {"X": 440.0, "Y": 347.0}], "listLeftChick": [{"X": 284.0, "Y": 454.0}], "listNoseBottom": [{"X": 336.0, "Y": 467.0}, {"X": 383.0, "Y": 476.0}, {"X": 430.0, "Y": 469.0}], "listRightChick": [{"X": 484.0, "Y": 458.0}], "listLeftEyeBrowTop": [{"X": 245.0, "Y": 292.0}, {"X": 259.0, "Y": 277.0}, {"X": 282.0, "Y": 270.0}, {"X": 313.0, "Y": 272.0}, {"X": 351.0, "Y": 277.0}], "listLipLower_Lower": [{"X": 441.0, "Y": 541.0}, {"X": 432.0, "Y": 547.0}, {"X": 417.0, "Y": 556.0}, {"X": 400.0, "Y": 561.0}, {"X": 381.0, "Y": 563.0}, {"X": 362.0, "Y": 561.0}, {"X": 345.0, "Y": 554.0}, {"X": 331.0, "Y": 545.0}, {"X": 322.0, "Y": 538.0}], "listLipLower_Upper": [{"X": 430.0, "Y": 534.0}, {"X": 423.0, "Y": 535.0}, {"X": 412.0, "Y": 535.0}, {"X": 397.0, "Y": 536.0}, {"X": 382.0, "Y": 537.0}, {"X": 366.0, "Y": 536.0}, {"X": 352.0, "Y": 534.0}, {"X": 340.0, "Y": 532.0}, {"X": 333.0, "Y": 532.0}], "listLipUpper_Lower": [{"X": 324.0, "Y": 530.0}, {"X": 343.0, "Y": 530.0}, {"X": 354.0, "Y": 532.0}, {"X": 367.0, "Y": 533.0}, {"X": 382.0, "Y": 535.0}, {"X": 396.0, "Y": 534.0}, {"X": 410.0, "Y": 533.0}, {"X": 421.0, "Y": 532.0}, {"X": 439.0, "Y": 533.0}], "listLipUpper_Upper": [{"X": 316.0, "Y": 532.0}, {"X": 321.0, "Y": 527.0}, {"X": 330.0, "Y": 523.0}, {"X": 342.0, "Y": 518.0}, {"X": 362.0, "Y": 514.0}, {"X": 382.0, "Y": 518.0}, {"X": 402.0, "Y": 515.0}, {"X": 422.0, "Y": 520.0}, {"X": 434.0, "Y": 526.0}, {"X": 443.0, "Y": 530.0}, {"X": 448.0, "Y": 535.0}], "listRightEyeBrowTop": [{"X": 536.0, "Y": 298.0}, {"X": 524.0, "Y": 282.0}, {"X": 501.0, "Y": 273.0}, {"X": 469.0, "Y": 275.0}, {"X": 431.0, "Y": 278.0}], "listLeftEyeBrowBottom": [{"X": 253.0, "Y": 302.0}, {"X": 267.0, "Y": 290.0}, {"X": 287.0, "Y": 285.0}, {"X": 316.0, "Y": 287.0}, {"X": 355.0, "Y": 301.0}], "listRightEyeBrowBottom": [{"X": 528.0, "Y": 306.0}, {"X": 515.0, "Y": 294.0}, {"X": 495.0, "Y": 288.0}, {"X": 466.0, "Y": 290.0}, {"X": 425.0, "Y": 302.0}]}

    tilted = {"listFace": [[430.0, 272.0], [451.0, 276.0], [486.0, 285.0], [509.0, 298.0], [522.0, 316.0], [529.0, 336.0], [530.0, 357.0], [527.0, 383.0], [523.0, 409.0], [517.0, 434.0], [509.0, 459.0], [497.0, 485.0], [483.0, 507.0], [469.0, 523.0], [453.0, 538.0], [438.0, 547.0], [422.0, 555.0], [402.0, 558.0], [386.0, 558.0], [371.0, 554.0], [352.0, 545.0], [339.0, 534.0], [328.0, 521.0], [316.0, 502.0], [307.0, 483.0], [299.0, 457.0], [296.0, 429.0], [296.0, 402.0], [298.0, 376.0], [302.0, 350.0], [307.0, 325.0], [314.0, 306.0], [328.0, 288.0], [347.0, 275.0], [372.0, 269.0], [410.0, 270.0]], "listLeftEye": [[338.0, 354.0], [340.0, 353.0], [343.0, 352.0], [349.0, 350.0], [359.0, 350.0], [367.0, 352.0], [376.0, 356.0], [382.0, 361.0], [384.0, 364.0], [382.0, 365.0], [377.0, 365.0], [368.0, 366.0], [360.0, 365.0], [351.0, 363.0], [345.0, 360.0], [341.0, 358.0]], "listNoseTop": [[416.0, 360.0], [402.0, 444.0]], "listRightEye": [[446.0, 373.0], [450.0, 370.0], [457.0, 367.0], [466.0, 365.0], [475.0, 366.0], [484.0, 369.0], [490.0, 372.0], [492.0, 374.0], [494.0, 375.0], [490.0, 378.0], [486.0, 379.0], [479.0, 381.0], [470.0, 380.0], [461.0, 378.0], [453.0, 376.0], [449.0, 374.0]], "listLeftChick": [[336.0, 430.0]], "listNoseBottom": [[371.0, 443.0], [401.0, 454.0], [433.0, 452.0]], "listRightChick": [[472.0, 449.0]], "listLeftEyeBrowTop": [[322.0, 323.0], [333.0, 315.0], [349.0, 313.0], [370.0, 318.0], [395.0, 324.0]], "listLipLower_Lower": [[437.0, 495.0], [429.0, 498.0], [419.0, 502.0], [406.0, 504.0], [394.0, 503.0], [382.0, 501.0], [371.0, 495.0], [362.0, 488.0], [357.0, 483.0]], "listLipLower_Upper": [[431.0, 490.0], [425.0, 490.0], [417.0, 490.0], [407.0, 489.0], [396.0, 488.0], [386.0, 486.0], [376.0, 484.0], [369.0, 482.0], [364.0, 480.0]], "listLipUpper_Lower": [[358.0, 478.0], [370.0, 480.0], [378.0, 483.0], [386.0, 485.0], [396.0, 488.0], [406.0, 488.0], [416.0, 488.0], [424.0, 488.0], [437.0, 490.0]], "listLipUpper_Upper": [[353.0, 478.0], [356.0, 477.0], [363.0, 476.0], [371.0, 474.0], [385.0, 474.0], [397.0, 478.0], [411.0, 478.0], [424.0, 482.0], [433.0, 486.0], [439.0, 489.0], [442.0, 492.0]], "listRightEyeBrowTop": [[518.0, 350.0], [510.0, 339.0], [495.0, 332.0], [474.0, 332.0], [448.0, 332.0]], "listLeftEyeBrowBottom": [[327.0, 330.0], [337.0, 324.0], [352.0, 323.0], [371.0, 328.0], [396.0, 340.0]], "listRightEyeBrowBottom": [[511.0, 355.0], [503.0, 347.0], [490.0, 342.0], [470.0, 342.0], [442.0, 347.0]]}
    tilted_r = {"listFace": [[241.0, 116.0], [261.0, 116.0], [295.0, 120.0], [317.0, 130.0], [332.0, 147.0], [341.0, 168.0], [346.0, 190.0], [349.0, 219.0], [352.0, 246.0], [353.0, 274.0], [351.0, 303.0], [345.0, 332.0], [336.0, 356.0], [327.0, 373.0], [316.0, 390.0], [306.0, 403.0], [294.0, 413.0], [276.0, 422.0], [261.0, 425.0], [244.0, 425.0], [221.0, 421.0], [203.0, 414.0], [185.0, 405.0], [166.0, 389.0], [148.0, 372.0], [132.0, 347.0], [121.0, 318.0], [115.0, 289.0], [112.0, 262.0], [111.0, 235.0], [113.0, 207.0], [119.0, 183.0], [133.0, 159.0], [152.0, 139.0], [180.0, 126.0], [219.0, 118.0]], "listLeftEye": [[161.0, 224.0], [165.0, 222.0], [168.0, 220.0], [175.0, 217.0], [184.0, 215.0], [193.0, 214.0], [203.0, 216.0], [210.0, 219.0], [213.0, 221.0], [210.0, 223.0], [205.0, 224.0], [197.0, 227.0], [188.0, 228.0], [178.0, 228.0], [171.0, 227.0], [166.0, 226.0]], "listNoseTop": [[249.0, 206.0], [263.0, 291.0]], "listRightEye": [[278.0, 217.0], [280.0, 214.0], [286.0, 210.0], [294.0, 207.0], [303.0, 206.0], [312.0, 207.0], [317.0, 209.0], [320.0, 211.0], [323.0, 212.0], [320.0, 215.0], [316.0, 216.0], [310.0, 218.0], [302.0, 220.0], [293.0, 220.0], [285.0, 218.0], [280.0, 218.0]], "listLeftChick": [[179.0, 300.0]], "listNoseBottom": [[223.0, 303.0], [259.0, 305.0], [288.0, 297.0]], "listRightChick": [[322.0, 288.0]], "listLeftEyeBrowTop": [[138.0, 195.0], [150.0, 182.0], [168.0, 174.0], [192.0, 173.0], [220.0, 174.0]], "listLipLower_Lower": [[299.0, 344.0], [293.0, 350.0], [285.0, 357.0], [275.0, 362.0], [262.0, 365.0], [247.0, 365.0], [234.0, 362.0], [222.0, 356.0], [214.0, 352.0]], "listLipLower_Upper": [[291.0, 340.0], [287.0, 341.0], [280.0, 343.0], [271.0, 344.0], [261.0, 346.0], [249.0, 346.0], [238.0, 346.0], [228.0, 346.0], [221.0, 347.0]], "listLipUpper_Lower": [[214.0, 346.0], [229.0, 345.0], [238.0, 345.0], [249.0, 344.0], [260.0, 344.0], [270.0, 342.0], [278.0, 341.0], [285.0, 340.0], [296.0, 339.0]], "listLipUpper_Upper": [[208.0, 348.0], [212.0, 344.0], [221.0, 340.0], [231.0, 335.0], [247.0, 331.0], [261.0, 332.0], [274.0, 328.0], [287.0, 330.0], [295.0, 334.0], [300.0, 336.0], [302.0, 339.0]], "listRightEyeBrowTop": [[338.0, 181.0], [330.0, 170.0], [316.0, 164.0], [297.0, 166.0], [273.0, 170.0]], "listLeftEyeBrowBottom": [[146.0, 200.0], [157.0, 190.0], [173.0, 184.0], [195.0, 183.0], [224.0, 190.0]], "listRightEyeBrowBottom": [[334.0, 187.0], [326.0, 178.0], [313.0, 175.0], [296.0, 177.0], [271.0, 187.0]]}
    r1 = {"listFace": [[410.0, 277.0], [426.0, 286.0], [451.0, 303.0], [462.0, 318.0], [464.0, 335.0], [460.0, 351.0], [454.0, 369.0], [441.0, 392.0], [431.0, 417.0], [419.0, 440.0], [404.0, 463.0], [386.0, 483.0], [369.0, 500.0], [355.0, 513.0], [341.0, 525.0], [329.0, 532.0], [317.0, 539.0], [300.0, 541.0], [286.0, 539.0], [272.0, 532.0], [253.0, 518.0], [239.0, 502.0], [226.0, 485.0], [214.0, 461.0], [204.0, 437.0], [199.0, 404.0], [201.0, 374.0], [208.0, 347.0], [217.0, 321.0], [228.0, 297.0], [243.0, 276.0], [261.0, 260.0], [288.0, 252.0], [316.0, 248.0], [349.0, 254.0], [389.0, 268.0]], "listLeftEye": [[285.0, 326.0], [289.0, 326.0], [294.0, 326.0], [301.0, 326.0], [311.0, 329.0], [319.0, 334.0], [327.0, 341.0], [331.0, 349.0], [332.0, 352.0], [330.0, 352.0], [325.0, 351.0], [317.0, 349.0], [309.0, 346.0], [300.0, 341.0], [293.0, 336.0], [289.0, 332.0]], "listNoseTop": [[373.0, 362.0], [351.0, 445.0]], "listRightEye": [[388.0, 377.0], [392.0, 376.0], [398.0, 374.0], [407.0, 375.0], [415.0, 378.0], [423.0, 382.0], [426.0, 386.0], [427.0, 388.0], [428.0, 390.0], [424.0, 391.0], [420.0, 392.0], [414.0, 392.0], [406.0, 390.0], [399.0, 386.0], [393.0, 381.0], [389.0, 378.0]], "listLeftChick": [[272.0, 406.0]], "listNoseBottom": [[310.0, 431.0], [341.0, 449.0], [364.0, 451.0]], "listRightChick": [[394.0, 454.0]], "listLeftEyeBrowTop": [[278.0, 288.0], [296.0, 285.0], [317.0, 290.0], [340.0, 305.0], [363.0, 321.0]], "listLipLower_Lower": [[352.0, 490.0], [346.0, 493.0], [338.0, 497.0], [328.0, 498.0], [318.0, 495.0], [306.0, 490.0], [296.0, 482.0], [288.0, 473.0], [283.0, 465.0]], "listLipLower_Upper": [[347.0, 484.0], [344.0, 484.0], [339.0, 483.0], [333.0, 482.0], [325.0, 480.0], [315.0, 476.0], [305.0, 471.0], [297.0, 467.0], [291.0, 464.0]], "listLipUpper_Lower": [[284.0, 460.0], [298.0, 466.0], [306.0, 471.0], [315.0, 475.0], [325.0, 479.0], [332.0, 481.0], [338.0, 482.0], [343.0, 482.0], [351.0, 484.0]], "listLipUpper_Upper": [[279.0, 459.0], [284.0, 459.0], [294.0, 461.0], [305.0, 462.0], [320.0, 465.0], [332.0, 471.0], [343.0, 473.0], [351.0, 477.0], [354.0, 481.0], [356.0, 484.0], [356.0, 487.0]], "listRightEyeBrowTop": [[453.0, 370.0], [452.0, 362.0], [445.0, 355.0], [430.0, 351.0], [409.0, 345.0]], "listLeftEyeBrowBottom": [[283.0, 297.0], [299.0, 296.0], [317.0, 302.0], [337.0, 314.0], [358.0, 336.0]], "listRightEyeBrowBottom": [[448.0, 375.0], [446.0, 368.0], [438.0, 363.0], [423.0, 358.0], [399.0, 357.0]]}
    l1 = {"listFace": [[268.0, 306.0], [289.0, 299.0], [329.0, 290.0], [361.0, 288.0], [386.0, 296.0], [407.0, 309.0], [421.0, 326.0], [431.0, 349.0], [438.0, 374.0], [444.0, 399.0], [448.0, 426.0], [449.0, 455.0], [445.0, 484.0], [436.0, 507.0], [426.0, 527.0], [415.0, 543.0], [403.0, 556.0], [387.0, 567.0], [373.0, 573.0], [360.0, 574.0], [343.0, 572.0], [331.0, 566.0], [318.0, 557.0], [303.0, 546.0], [289.0, 533.0], [272.0, 517.0], [255.0, 496.0], [242.0, 474.0], [231.0, 450.0], [221.0, 425.0], [209.0, 401.0], [203.0, 381.0], [201.0, 362.0], [206.0, 344.0], [221.0, 329.0], [250.0, 314.0]], "listLeftEye": [[239.0, 421.0], [240.0, 419.0], [241.0, 416.0], [245.0, 412.0], [253.0, 408.0], [261.0, 406.0], [270.0, 407.0], [277.0, 410.0], [281.0, 412.0], [280.0, 414.0], [276.0, 416.0], [270.0, 420.0], [262.0, 424.0], [253.0, 425.0], [247.0, 425.0], [243.0, 423.0]], "listNoseTop": [[300.0, 396.0], [319.0, 479.0]], "listRightEye": [[338.0, 393.0], [339.0, 389.0], [344.0, 381.0], [352.0, 374.0], [362.0, 370.0], [372.0, 368.0], [378.0, 369.0], [382.0, 370.0], [385.0, 371.0], [382.0, 376.0], [378.0, 381.0], [372.0, 386.0], [363.0, 390.0], [354.0, 392.0], [345.0, 392.0], [340.0, 393.0]], "listLeftChick": [[272.0, 488.0]], "listNoseBottom": [[301.0, 486.0], [328.0, 486.0], [357.0, 470.0]], "listRightChick": [[396.0, 449.0]], "listLeftEyeBrowTop": [[212.0, 399.0], [214.0, 390.0], [224.0, 382.0], [242.0, 379.0], [264.0, 375.0]], "listLipLower_Lower": [[386.0, 505.0], [380.0, 512.0], [372.0, 520.0], [362.0, 527.0], [349.0, 532.0], [338.0, 534.0], [327.0, 532.0], [318.0, 529.0], [311.0, 525.0]], "listLipLower_Upper": [[378.0, 503.0], [372.0, 506.0], [363.0, 510.0], [353.0, 514.0], [343.0, 517.0], [334.0, 519.0], [326.0, 520.0], [320.0, 520.0], [316.0, 520.0]], "listLipUpper_Lower": [[311.0, 520.0], [321.0, 519.0], [327.0, 519.0], [334.0, 518.0], [343.0, 517.0], [353.0, 513.0], [362.0, 510.0], [371.0, 506.0], [384.0, 500.0]], "listLipUpper_Upper": [[306.0, 522.0], [307.0, 520.0], [311.0, 517.0], [315.0, 514.0], [325.0, 510.0], [337.0, 509.0], [349.0, 503.0], [364.0, 501.0], [376.0, 500.0], [384.0, 499.0], [389.0, 500.0]], "listRightEyeBrowTop": [[395.0, 334.0], [380.0, 329.0], [360.0, 331.0], [338.0, 343.0], [314.0, 356.0]], "listLeftEyeBrowBottom": [[218.0, 404.0], [221.0, 397.0], [231.0, 391.0], [247.0, 388.0], [274.0, 388.0]], "listRightEyeBrowBottom": [[390.0, 343.0], [377.0, 340.0], [360.0, 343.0], [340.0, 353.0], [316.0, 372.0]]}
    occ1 = {"listFace": [[365.0, 185.0], [397.0, 184.0], [452.0, 186.0], [488.0, 197.0], [513.0, 219.0], [530.0, 245.0], [541.0, 279.0], [548.0, 322.0], [556.0, 365.0], [562.0, 409.0], [564.0, 455.0], [559.0, 500.0], [548.0, 541.0], [533.0, 571.0], [514.0, 599.0], [496.0, 618.0], [476.0, 634.0], [448.0, 647.0], [425.0, 652.0], [400.0, 651.0], [366.0, 645.0], [338.0, 632.0], [311.0, 616.0], [280.0, 591.0], [253.0, 563.0], [225.0, 523.0], [205.0, 478.0], [194.0, 433.0], [188.0, 390.0], [185.0, 348.0], [185.0, 307.0], [191.0, 273.0], [209.0, 242.0], [233.0, 215.0], [273.0, 198.0], [332.0, 188.0]], "listLeftEye": [[255.0, 347.0], [259.0, 344.0], [264.0, 341.0], [273.0, 336.0], [287.0, 332.0], [302.0, 333.0], [317.0, 337.0], [328.0, 344.0], [333.0, 349.0], [330.0, 350.0], [323.0, 352.0], [311.0, 356.0], [297.0, 358.0], [282.0, 358.0], [271.0, 356.0], [263.0, 352.0]], "listNoseTop": [[384.0, 334.0], [403.0, 472.0]], "listRightEye": [[432.0, 342.0], [437.0, 337.0], [446.0, 328.0], [460.0, 322.0], [474.0, 319.0], [488.0, 320.0], [497.0, 323.0], [501.0, 326.0], [504.0, 328.0], [499.0, 335.0], [492.0, 339.0], [483.0, 344.0], [469.0, 346.0], [455.0, 346.0], [443.0, 343.0], [435.0, 343.0]], "listLeftChick": [[285.0, 465.0]], "listNoseBottom": [[345.0, 475.0], [400.0, 485.0], [451.0, 470.0]], "listRightChick": [[505.0, 449.0]], "listLeftEyeBrowTop": [[217.0, 306.0], [233.0, 292.0], [260.0, 284.0], [296.0, 286.0], [337.0, 290.0]], "listLipLower_Lower": [[470.0, 531.0], [461.0, 537.0], [447.0, 545.0], [430.0, 551.0], [412.0, 554.0], [392.0, 555.0], [373.0, 551.0], [354.0, 544.0], [340.0, 537.0]], "listLipLower_Upper": [[459.0, 527.0], [451.0, 529.0], [439.0, 530.0], [424.0, 533.0], [408.0, 534.0], [391.0, 535.0], [375.0, 534.0], [360.0, 533.0], [350.0, 533.0]], "listLipUpper_Lower": [[338.0, 532.0], [358.0, 533.0], [371.0, 534.0], [388.0, 536.0], [405.0, 536.0], [423.0, 534.0], [437.0, 532.0], [450.0, 529.0], [468.0, 526.0]], "listLipUpper_Upper": [[329.0, 532.0], [333.0, 529.0], [345.0, 527.0], [358.0, 524.0], [381.0, 521.0], [404.0, 523.0], [426.0, 519.0], [448.0, 520.0], [462.0, 522.0], [473.0, 523.0], [478.0, 525.0]], "listRightEyeBrowTop": [[524.0, 281.0], [510.0, 270.0], [487.0, 267.0], [456.0, 275.0], [419.0, 284.0]], "listLeftEyeBrowBottom": [[228.0, 316.0], [243.0, 305.0], [267.0, 300.0], [301.0, 302.0], [345.0, 314.0]], "listRightEyeBrowBottom": [[518.0, 293.0], [505.0, 285.0], [484.0, 284.0], [455.0, 291.0], [417.0, 309.0]]}

    img = Image.open('./l1.jpg')
    pilimg,vectors = FaceAlignment.face_image_landmark_alignment(img,l1,plot=True)
    plt.imshow(pilimg)
    plt.show()
    
